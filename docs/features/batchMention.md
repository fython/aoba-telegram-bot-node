# 分类批量提及人功能

源码：[src/features/batchMention.ts](src/features/batchMention.ts)

## 功能概述

群组内，允许用户主动为自己添加中文标签（必须汉字开头，后面可以接英文或数字，不能接符号和空格），当其他人在群组中发送带有 `@xxxx` 的文本信息时，寻找当前群组中符合标签的人，并由机器人批量提及它们。

## 功能描述

### 命令 `/member_tag_add`

- **命令名称**: `/member_tag_add`
- **简短描述**: 为我或指定成员在当前群聊中添加标签
- **详细描述**: 使用 `/member_tag_add <标签> [@用户名]` 命令为自己或指定用户在当前群组中添加一个标签

#### 输入验证

命令必须提供至少一个参数，当仅提供一个参数时，默认为自己添加标签；当提供两个参数时，为第二个参数中所指定的用户添加标签；

#### 核心功能

1. 获取第一个参数作为要添加的标签 `T`
2. 尝试获取第二个参数作为要指定的用户 `U`，如果没有参数则以自己为目标
3. 检查指定用户 `U` 在当前群组 `G` 中是否已经添加过相同名称的标签 `T` ，如果已经添加过则提示不能重复添加
4. 在数据库中添加指定用户 `U` 在当前群聊 `G` 中拥有标签 `T` 的记录

### 命令 `/member_tag_del`

- **命令名称**: `/member_tag_del`
- **简短描述**: 删除我或指定成员在当前群聊中的标签
- **详细描述**: 使用 `/member_tag_del <标签> [@用户名]` 命令删除自己或指定用户在当前群组中的标签

#### 输入验证

命令必须提供至少一个参数，当仅提供一个参数时，默认为自己删除标签；当提供两个参数时，为第二个参数中所指定的用户删除标签；

#### 核心功能

和 `/member_tag_add` 相似，区别是 `/member_tag_del` 为删除标签操作

### 命令 `/member_tag_list`

- **命令名称**: `/member_tag_list`
- **简短描述**: 列出我或指定成员在当前群聊中的标签
- **详细描述**: 使用 `/member_tag_list [@用户名]` 命令列出自己或指定用户在当前群组中的所有标签

#### 输入验证

命令可以不提供参数，默认为列出自己在当前群组中的标签；当提供参数时，为第二个参数中所指定的用户列出标签。

#### 核心功能

1. 尝试获取第二个参数作为要查询的用户 `U`，如果没有参数则以自己为目标
2. 查询指定用户 `U` 在当前群组 `G` 中拥有的所有标签
3. 将查询到的标签列表返回给用户

### 命令 `/member_tag_all`

- **命令名称**: `/member_tag_all`
- **简短描述**: 列出当前群组所有标签以及各标签下的成员列表

#### 输入验证

命令不需要提供任何参数

#### 核心功能

1. 获取当前消息所在群组 ID
2. 在数据库中查询指定群组 ID 包含的所有标签
3. 按标签分组，列出各标签下的成员列表

### 发送包含 `@标签` 的文本消息

- **描述**: 发送带有标签的消息并自动提及相关成员

#### 输入验证

消息文本中必须包含 `@标签` 的格式，且标签必须是当前群组中已存在的标签。

#### 核心功能

1. 解析消息文本中的 `@标签`，提取出所有标签
2. 查询当前群组中所有拥有这些标签的成员
3. 将查询到的用户以 `@用户名1 @用户名2 ...` 的格式引用第一步的原消息

## 使用场景

### 使用用例

#### 示例 1:

```text
活动组织人发送： `有人约饭吗 @群广州人`
机器人回复： `@fython @user114514 @user114515 @user114516`
```
