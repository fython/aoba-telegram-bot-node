# 替换文字功能

源码：[src/features/replace.ts](src/features/replace.ts)

## 功能概述

替换文字功能允许用户通过回复消息的方式替换指定消息中的文本内容，提供便捷的文本编辑功能。

## 功能描述

### 命令信息

- **命令名称**: `/replace`
- **简短描述**: 替换文本中的指定内容
- **详细描述**: 使用 /replace <old_text> <new_text> 命令替换文本中的指定内容

### 使用方式

1. 用户需要回复一条包含文本的消息
2. 使用命令格式：`/replace <old_text> <new_text>`
   - `<old_text>`: 要被替换的原始文本
   - `<new_text>`: 用于替换的新文本

## 功能要求

### 输入验证

1. **参数检查**: 必须提供恰好两个参数（旧文本和新文本）
   - 如果参数数量不正确，返回使用说明
2. **回复消息检查**: 必须回复一条包含文本的消息
   - 如果没有回复消息或回复的消息不包含文本，提示用户正确使用方式

### 核心功能

1. **文本替换**: 使用全局替换模式（RegExp 的 'g' 标志）将旧文本替换为新文本
2. **消息格式**: 替换后的消息格式为 `{原消息发送者}：{替换后的文本}`

## 使用场景

### 典型使用场景

1. **纠正错别字**: 用户发现某条消息有错别字，使用 replace 功能快速纠正
2. **刻意误解原意**: 与好友交流时在对话原意基础上替换关键词玩梗

### 使用示例

#### 示例 1: 纠正错别字

```text
原消息: "今天天汽很好"
用户回复: `/replace 天汽 天气`
机器人回复: "张三：今天天气很好"
```

#### 示例 2: 刻意误解原意

```text
原消息: "早上好"
用户回复: `/replace 好 坏`
机器人回复: "李四：早上坏"
```

## 错误处理

### 错误情况及响应

1. **参数数量错误**
   - 错误提示: "请提供要替换的旧文本和新文本。用法: /replace <old_text> <new_text>"

2. **未回复消息或回复消息无文本**
   - 错误提示: "请回复一条包含文本的消息来进行替换。"

3. **回复消息无文本内容**
   - 错误提示: "没有找到需要替换的文本。"

## 注意事项

### 使用限制

1. 只能替换文本消息，不支持其他类型的消息（图片、文档等）
2. 替换是全局的，会替换所有匹配的文本
3. 不支持正则表达式模式的高级替换

### 安全考虑

1. 不对用户输入进行特殊字符转义，需要注意特殊字符可能被解释为正则表达式

## 未来改进建议

1. **正则表达式支持**: 添加可选的正则表达式替换模式
2. **替换预览**: 在执行替换前显示预览结果
3. **撤销功能**: 提供撤销最近一次替换的功能
4. **批量替换**: 支持一次替换多个不同的文本对
5. **权限控制**: 限制只有消息发送者或管理员才能替换消息内容
