# 语录功能

源码：[src/features/yulu.ts](src/features/yulu.ts)

## 功能概述

记录和分享群组成员的有趣言论。用户可以将消息保存为“语录”，并通过命令或内联查询随时引用。

## 功能描述

### 命令

#### `/yulu`

- **命令名称**: `/yulu`
- **简短描述**: 录入语录
- **详细描述**: 回复一条文本信息，并输入 `/yulu` 命令来录入语录。录入后可以通过内联查询回放。
- **核心功能**:
    1. 提取回复的文本消息内容和作者信息。
    2. 检查该语录是否已存在，避免重复录入。
    3. 将消息内容、作者、提交者等信息存入数据库。

#### `/yulu_list`

- **命令名称**: `/yulu_list`
- **简短描述**: 查看语录列表
- **详细描述**: 查看自己被录入的语录列表。可以通过 `@username` 查看指定用户的语录。
- **核心功能**:
    1. 解析命令参数，确定目标用户。
    2. 从数据库分页查询目标用户的语录。
    3. 以分页列表形式展示语录，并提供翻页按钮。

#### `/yulu_del`

- **命令名称**: `/yulu_del`
- **简短描述**: 删除指定 ID 的语录
- **详细描述**: 删除指定 ID 的语录。仅限语录的作者或录入者可以操作。
- **核心功能**:
    1. 解析命令获取语录 ID。
    2. 校验操作者是否有权限删除（必须是作者或提交者）。
    3. 从数据库中删除指定的语录。

### 内联查询

- **触发方式**: 在任意聊天框输入 `@<username>`
- **功能**:
    1. 当用户在输入框中输入以 `@` 开头的文本时，会触发内联查询。
    2. 查询并展示对应用户的语录列表。
    3. 用户选择一条语录后，机器人会将该语录内容发送到当前聊天。

## 使用场景

### 典型使用场景

1.  **保存金句**: 记录群聊中有趣、经典或值得纪念的发言。
2.  **快速引用**: 在聊天中通过内联查询快速引用某人的经典名言。
3.  **娱乐互动**: 增加群聊的趣味性和互动性。

### 使用用例

#### 示例 1: 录入语录

```text
用户A: "今天天气真好"
用户B (回复用户A的消息): /yulu
机器人: "已录入 @用户A 的语录"
```

#### 示例 2: 查看语录列表

```text
用户B: /yulu_list @用户A
机器人:
@用户A 的语录 (第 1/1 页):
1. 今天天气真好
```

#### 示例 3: 删除语录

```text
用户A: /yulu_del 1
机器人: "已删除语录 ID=1"
```

#### 示例 4: 内联查询

```text
用户C (在输入框输入): @用户A
(出现内联查询结果列表，显示 "今天天气真好")
用户C (点击结果):
机器人 (在聊天中发送): `@用户A`: 今天天气真好
```
